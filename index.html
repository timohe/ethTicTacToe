<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Super Smart Contract .... not</title>

    <script src="https://cdn.rawgit.com/ethereum/web3.js/1.0/dist/web3.min.js"></script>
</head>
<body>
    <div class="container">

		<div>
			<h3>Contract Address (will be hardcoded if deployed final version)</h3>
			<input name="contractAddress" id="contractAddress" type="text">
			<button onclick="setContractAddress();" id="button">Set Contract Address</button>
		</div>

        <h3>Host a new game</h3>
		<button onclick="host();" id="button">Host new game</button>

        <!-- <h2 id="instructor"></h2> -->
		
        <div>
			<h3>Hosts address to join game</h3>
			<input name="hostAddress" id="hostAddress" type="text">
			<button onclick="join();" id="button">Join hosted game</button>

		</div>
		
		<div>
			<h3>Print the board</h3>
			<button onclick="printBoard();" id="button">Print Board</button>
		</div>
		
		

        <!-- <label for="name" class="col-lg-2 control-label">Instructor Age</label>
        <input id="age" type="text"> -->

		


    </div>

    <script>
        web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));		
		web3.eth.defaultAccount = web3.eth.accounts[0];

		var contractAddr;
		var contractAbi = [
				{
					"anonymous": false,
					"inputs": [
						{
							"indexed": false,
							"name": "error",
							"type": "string"
						}
					],
					"name": "Error",
					"type": "event"
				},
				{
					"constant": false,
					"inputs": [],
					"name": "hostNewGame",
					"outputs": [
						{
							"name": "message",
							"type": "string"
						}
					],
					"payable": true,
					"stateMutability": "payable",
					"type": "function"
				},
				{
					"constant": false,
					"inputs": [
						{
							"name": "host",
							"type": "address"
						}
					],
					"name": "joinExistingGame",
					"outputs": [],
					"payable": true,
					"stateMutability": "payable",
					"type": "function"
				},
				{
					"constant": false,
					"inputs": [
						{
							"name": "host",
							"type": "address"
						},
						{
							"name": "row",
							"type": "uint256"
						},
						{
							"name": "column",
							"type": "uint256"
						}
					],
					"name": "play",
					"outputs": [
						{
							"name": "message",
							"type": "string"
						}
					],
					"payable": false,
					"stateMutability": "nonpayable",
					"type": "function"
				},
				{
					"constant": false,
					"inputs": [
						{
							"name": "host",
							"type": "address"
						}
					],
					"name": "printBoard",
					"outputs": [
						{
							"name": "isHostsTurn",
							"type": "bool"
						},
						{
							"name": "board1",
							"type": "uint256"
						},
						{
							"name": "board2",
							"type": "uint256"
						},
						{
							"name": "board3",
							"type": "uint256"
						}
					],
					"payable": false,
					"stateMutability": "nonpayable",
					"type": "function"
				}		
			]
		var contract;
		var myAddress = web3.eth.getAccounts();
		
		

		function setContractAddress() {
			contractAddr = document.getElementById("contractAddress").value;
			console.log("Address set as: " + contractAddr);
			contract = new web3.eth.Contract(contractAbi, contractAddr);
		}

		function host(){
			console.log("This is your address: " + JSON.stringify(myAddress.fulfillmentValue[0]));
			console.log("Hosting new game...");	
			valueToTransact = web3.utils.toWei('5', 'ether');
			contract.methods.hostNewGame().send({from: myAddress, value: valueToTransact})
				.on('receipt', function(receipt){console.log(receipt)})
				.on('error', function(error){
					var savedError = error;
					console.log("This is the error: " + JSON.stringify(savedError));
				})
		};

		function joinExistingGame(){
			console.log("Joining existing game...");	
			valueToTransact = web3.utils.toWei('5', 'ether');
			contract.methods.joinExistingGame(hostAdr).send({from: web3.eth.accounts[0], value: valueToTransact})
				.on('receipt', function(receipt){console.log(receipt)})
				.on('error', function(error){
					var savedError = error;
					console.log("This is the error: " + JSON.stringify(savedError));
				})
		};

		function play(uint, uint){
			console.log("Joining existing game...");	
			valueToTransact = web3.utils.toWei('5', 'ether');
			contract.methods.playGame(hostAdr).send({from: web3.eth.accounts[0], value: valueToTransact})
				.on('receipt', function(receipt){console.log(receipt)})
				.on('error', function(error){
					var savedError = error;
					console.log("This is the error: " + JSON.stringify(savedError));
				})
		};

		function printBoard(){
			console.log("Getting state...");	
			//TODO: get state
			contract.methods.printBoard(hostAdr).call()
				.then(console.log);
		};


    </script>

</body>
</html>